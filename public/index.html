<html>
  <head>
    <title>FloppyFishies.io by oceanverse.eth</title>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://npmcdn.com/moralis@latest/dist/moralis.js"></script>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>


  </head>

  <body>

    <button id="btn-login">Metamask Login</button>
    <button id="btn-logout">Logout</button>
    <br><br>

    <script>
      // connect to Moralis server
      Moralis.initialize("4SJbqJrqj31Vy4zgP6qTXSQZM4EKpUn6CqreX6Xi");
      Moralis.serverURL = "https://irgjvyx5h7jg.usemoralis.com:2053/server";



	var config = {
    	type: Phaser.AUTO,
    	width: 800,
    	height: 600,
	physics: {
		default: 'arcade',
		arcade: {
			gravity: { y: 120 },
			debug: true
		}
	},
    	scene: {
        	preload: preload,
        	create: create,
        	update: update
    		}
	};

	var game = new Phaser.Game(config);
	var platforms;
	var player;
	    
	// loading assets
	function preload ()
	{
		this.load.image('background', 'assets/BG.png');
		this.load.image('ground', 'assets/Tiles/Tile (2).png');
		this.load.image('player', 'assets/player.png');
	}

	// initial setup
	function create ()
	{
		this.add.image(400, 300, 'background').setScale(0.55);
		
		platforms = this.physics.add.staticGroup();
		platforms.create(470, 400, 'ground').setScale(0.5).refreshBody();
		platforms.create(535, 400, 'ground').setScale(0.5).refreshBody();
		platforms.create(600, 400, 'ground').setScale(0.5).refreshBody();
		platforms.create(665, 400, 'ground').setScale(0.5).refreshBody();
		
		player = this.physics.add.sprite(500, 300, 'player').setScale(0.1).refreshBody()
		player.setBounce(0.2);
		player.setCollideWorldBounds(true);
		this.physics.add.collider(player, platforms);
		
		cursors = this.input.keyboard.createCursorKeys();
		




	}

	// 60 frames per second
	function update ()
	{
				// logic
		if (cursors.left.isDown)
			{
			    player.setVelocityX(-80);
			    player.flipX = true;

			}
		else if (cursors.right.isDown)
			{
			    player.setVelocityX(80);
			    player.flipX = false;

			}
		else
			{
			    player.setVelocityX(0);
			}

		if (cursors.up.isDown)
			{
			    player.setVelocityY(-60);
			}
		else if (cursors.down.isDown)
			{
			    player.setVelocityY(60)
			}
			
	}


      // add from here down
      async function login() {
        let user = Moralis.User.current();
        if (!user) {
          user = await Moralis.Web3.authenticate();
          launch()
        }
        console.log("logged in user:", user);
      }

      async function logOut() {
        await Moralis.User.logOut();
        console.log("logged out");
        location.reload();
      }


      document.getElementById("btn-login").onclick = login;
      document.getElementById("btn-logout").onclick = logOut;




    </script>


  </body>


</html>
